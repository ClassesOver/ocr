[supervisord]
nodaemon=true
user=root
logfile=/app/logs/supervisord.log
pidfile=/var/run/supervisord.pid
loglevel=info

[program:gunicorn]
command=/app/.venv/bin/gunicorn -c gunicorn.conf.py --bind "0.0.0.0:%(ENV_FLASK_PORT)s" api:app
directory=/app/code
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/app/logs/gunicorn.log
stderr_logfile=/app/logs/gunicorn.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
environment=PATH="/app/.venv/bin:%(ENV_PATH)s",VIRTUAL_ENV="/app/.venv"
priority=100

[program:paddlex]
command=/app/.venv/bin/paddlex --serve --pipeline table_recognition_v2.yaml --use_hpip --host 0.0.0.0 --port %(ENV_PADDLEX_PORT)s
directory=/app/code
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/app/logs/paddlex.log
stderr_logfile=/app/logs/paddlex.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile_backups=10
environment=PATH="/app/.venv/bin:%(ENV_PATH)s",VIRTUAL_ENV="/app/.venv"
priority=200

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

